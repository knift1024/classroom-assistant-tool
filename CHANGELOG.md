# 變更日誌 (Changelog)

## [版本日期: 2024-05-25] - 筆刷體驗優化與修復

### ✨ 新功能與增強 (Features & Enhancements)
*   **滑鼠滾輪調整大小**: 在畫布上使用滑鼠滾輪，可以快速調整當前畫筆或橡皮擦的粗細，並同步更新工具列上的滑桿。

### 🐛 問題修復與穩定性提升 (Bug Fixes & Stability)
*   **文字模式停用滾輪**: 在文字輸入模式下，停用滑鼠滾輪調整筆觸大小的功能，避免誤操作。
*   **文字大小顯示一致性**: 修正了文字工具在輸入時的預覽字體大小與最終繪製到畫布上的字體大小不一致的問題。根本原因為 `px` (像素) 與 `pt` (點) 單位混用，現已統一使用 `pt` (點) 為單位。

---

## [版本日期: 2025-07-24] - 文字工具增強與穩定性修復

### ✨ 新功能與增強 (Features & Enhancements)
*   **新增文字工具**: 在畫記模式中加入了全新的「文字」工具，使用者可以在畫布上點擊並輸入文字。
*   **文字工具選項**: 為文字工具新增了「字體選擇」和「字體大小」的下拉選單，並會自動儲存使用者的偏好設定。
*   **可拖曳文字框**: 在輸入文字時，使用者可以自由拖曳文字框，以精確調整其最終位置。

### 🐛 問題修復與穩定性提升 (Bug Fixes & Stability)
*   **修正工具列意外拖曳**: 徹底解決了在操作字體或畫布的下拉選單時（包含點擊箭頭、拖曳滾動軸或在列表上滑動），會意外拖動整個工具列的惱人問題。現在只有在直接拖曳工具列背景時才會移動，所有元件的互動都已恢復正常。
*   **修正字體載入警告**: 透過篩選並只載入可縮放的現代字體，解決了在 Windows 上啟動時，因嘗試載入過時的點陣字體而產生的大量 `DirectWrite` 警告。
*   **修正匯入錯誤**: 修正了 `QFontMetrics` 模組從 `PyQt5.QtCore` 錯誤匯入的問題，將其更正至 `PyQt5.QtGui`，解決了啟動時的 `ImportError`。

---

## [版本日期: 2025-07-24] - 圓形工具體驗優化

### ✨ 新功能與增強 (Features & Enhancements)
*   **功能改良 (螢幕畫記)**: 大幅改善了「圓形」工具的使用者體驗，將其繪製方式從「對角線模式」改為更直覺的「**中心點-半徑模式**」。使用者現在可以先點擊確定圓心，再向外拖曳來決定半徑，從而更精確地控制圓形的位置和大小。

## [近期更新] - 螢幕畫記模式下的多工具協作

這是一系列針對螢幕畫記模式的重大可用性更新，旨在實現更流暢的多工操作體驗。

### ✨ 新功能與增強 (Features & Enhancements)

*   **畫記時啟用其他工具**: 現在您可以在啟用「螢幕畫記」模式的同時，無縫地開啟並使用「計時器」和「抽籤工具」。主工具列會在進入畫記模式後重新出現，並保持在畫布之上。

### 🐛 問題修復與穩定性提升 (Bug Fixes & Stability)

*   **修正工具視窗被遮擋**: 解決了在畫記模式下，新開啟的計時器或抽籤視窗會出現在畫布底下而無法看見的問題。現在所有工具視窗都會正確地顯示在最上層。
*   **修正主工具列收合時消失**: 解決了在畫記模式下，當主工具列被收合或展開時，會意外消失在畫布下方的問題。
*   **修正點擊畫布導致工具消失**: 解決了在畫記模式下，當使用者點擊畫布進行繪圖時，主工具列和其他已開啟的工具視窗會被畫布遮蓋的問題。現在所有工具都會在點擊畫布後自動回到最上層。

## [版本日期: 2024-05-24] - 今日開發重點

### ✨ 新增功能 (Features)

- **螢幕畫記模組化**:
  - 將 `screen_draw.py` 中的 `MovableToolbar` 邏輯完全分離至獨立的 `toolbar.py` 模組。
  - 主視窗 `ScreenDrawWindow` 與 `MovableToolbar` 之間改用信號與槽 (Signals & Slots) 機制通訊，大幅降低耦合度，提升可維護性。

- **工具列 UI 與 UX 優化**:
  - **快速調色盤**: 新增包含常用色（黑、白、紅、藍、綠、黃、螢光色）的調色盤，並保留「自訂顏色」功能，簡化顏色切換步驟。
  - **合併工具按鈕**: 將「手繪/螢光筆」、「直線/箭頭」、「矩形/圓形」合併為可循環切換的按鈕，使工具列更加簡潔。
  - **防止意外拖曳**: 引入拖曳閾值 (Drag Threshold)，避免在高頻點擊按鈕時意外移動工具列。
  - **固定按鈕寬度**: 為所有會改變文字的合併按鈕設定固定寬度，解決了切換工具時 UI 橫移的問題。

- **橡皮擦功能增強**:
  - **獨立擦除寬度**: 為橡皮擦設定了獨立的粗細變數 (`eraser_width`)，與畫筆寬度分開，並可記憶設定。
  - **視覺化擦除範圍**: 將滑鼠游標在橡皮擦模式下變更為一個與擦除範圍大小一致的虛線圓圈，提升操作直觀性。
  - **套用平滑化**: 橡皮擦現在也能夠套用「平滑化」效果，使其擦除邊緣與手繪筆觸一樣圓滑。

- **螢光筆模式**:
  - 新增「螢光筆」繪圖模式，可繪製出具有半透明效果的平頭筆觸。

### 🐛 問題修復 (Bug Fixes)

- **保留畫記內容**: 修正了從畫記模式退回主工具列再返回時，先前畫記內容會消失的問題。現在會保留筆跡，並更新背景為最新的桌面畫面。
- **同步調色盤高亮**: 修正了程式重啟後，畫筆顏色雖然正確，但工具列調色盤高亮狀態與實際顏色不符的問題。
- **工具切換邏輯修正**:
  - 修正了從螢光筆模式切換到其他工具後，狀態被錯誤重設為手繪的問題。
  - 修正了在橡皮擦模式下點擊調色盤，會固定切回「手繪」而不是之前工具（如螢光筆）的問題。

### 🛠️ 程式碼重構與修復

- **ImportError 修正**: 修正了 `QByteArray` 從 `PyQt5.QtGui` 錯誤匯入的問題，將其更正為從 `PyQt5.QtCore` 匯入。
- **鎖頭按鈕問題**: 重新加入在重構過程中意外被移除的工具列鎖頭按鈕，並恢復其功能。